# ipsec.conf - strongSwan IPsec configuration file

config setup
  charonstart=yes
  plutostart=no
  nat_traversal=<%= @nat_traversal %>

<% @peers.each_with_index do |peer, index| -%>
conn <%= @connection_type %>-<%= index %>
  left=<%= node[:ipaddress] %>
  right=<%= peer[:ipaddress] %>
<% if @connection_type == "net-net" -%>
  leftsubnets=<%= IPSec.get_subnets(node) %>
  rightsubnets=<%= IPSec.get_subnets(peer) %>
<% end -%>
  authby=secret
  keyexchange=ikev2
  auto=start
  mobike=no
  forceencaps=yes
  leftfirewall=yes
<% end -%>

include /var/lib/strongswan/ipsec.conf.inc
